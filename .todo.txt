Add;

Version 1.x:
    - better error for empty file when `scan`
    - SIGINT capture for new scanning.
    - vendor/composer/installed.json to SS.
    - Add "output to file" functionality.
        - resume when -U and "output to file"
    - URL after redirect is not provided?
    - When mass-scanning with CMS provided, it sometimes says cms_name is
          something it's not. Like, when versions: [] is empty true, but now even
          more misleading.
    - InvalidSchema: No connection adapters were found for 'd:/htdocs/404.html'
    
    real problems:
        - Crashes after 3k hosts.
            http://www.lshift.net/blog/2008/11/14/tracing-python-memory-leaks/
            https://pythonhosted.org/Pympler/muppy.html#muppy
            http://www.huyng.com/posts/python-performance-analysis/
            http://stackoverflow.com/questions/14270053/python-requests-not-clearing-memory-when-downloading-with-sessions
            https://gist.github.com/brianewing/994303
            - Data in this loop: 
                https://github.com/droope/droopescan/blob/development/dscan/plugins/internal/scan.py#L124-L146 
                not freed
                
                
root@personalChunk:~/droopescan# time python3 ./droopescan scan --massscan-override -U ../1kk_scan/head_1kk.txt -e v --error-log ../1kk_scan/error-log.txt | tee ../1kk_scan/results.json
                                  types |   # objects |   total size
======================================= | =========== | ============
                           <class 'list |        6094 |      2.58 MB
                           <class 'dict |        4462 |      1.87 MB
                            <class 'str |        6063 |    774.37 KB
             <class '_io.BufferedReader |          27 |    216.85 KB
  <class 'xml.etree.ElementTree.Element |        2287 |    142.94 KB
     <class 'builtin_function_or_method |        1319 |     92.74 KB
                      <class 'traceback |        1066 |     74.95 KB
                            <class 'set |          71 |     45.09 KB
                          <class 'tuple |         598 |     41.99 KB
        <class 'collections.OrderedDict |          13 |     39.36 KB
                        <class 'weakref |         366 |     31.45 KB
           <class 'threading._Condition |         453 |     28.31 KB
                            <class 'int |         901 |     25.22 KB
                         <class 'method |         260 |     18.28 KB
             <class '_io.BufferedWriter |           4 |     16.72 KB
{"host": ["http://www.0041200.com/", null], "version": {"is_empty": false, "finds": ["4.2.3"]}, "cms_name": "wordpress"}
                                                   types |   # objects |   total size
======================================================== | =========== | ============
                                            <class 'dict |        2669 |      1.61 MB
                              <class '_io.BufferedReader |          42 |    343.55 KB
                                             <class 'str |         690 |    101.16 KB
                                       <class 'traceback |        1178 |     82.83 KB
                      <class 'builtin_function_or_method |         990 |     69.61 KB
                                            <class 'list |         818 |     62.90 KB
                                           <class 'tuple |         593 |     41.17 KB
                                         <class 'weakref |         293 |     25.18 KB
                            <class 'threading._Condition |         297 |     18.56 KB
                           <class 'http.cookiejar.Cookie |         293 |     18.31 KB
                                          <class 'method |         243 |     17.09 KB
                                   function (weakref_cb) |          99 |     13.15 KB
                                             <class 'set |          56 |     12.69 KB
  <class 'requests.packages.urllib3.util.timeout.Timeout |         185 |     11.56 KB
                                    <class '_thread.lock |         297 |      9.28 KB
{"host": ["http://www.0041200.com/", null], "version": {"is_empty": false, "finds": ["4.2.3"]}, "cms_name": "wordpress"}
                                                   types |   # objects |   total size
======================================================== | =========== | ============
                                            <class 'dict |        4794 |      3.23 MB
                              <class '_io.BufferedReader |          44 |    359.91 KB
                                       <class 'traceback |        1814 |    127.55 KB
                                             <class 'str |         673 |    102.40 KB
                      <class 'builtin_function_or_method |         990 |     69.61 KB
                           <class 'http.cookiejar.Cookie |         892 |     55.75 KB
                                            <class 'list |         759 |     54.98 KB
                                             <class 'set |          96 |     45.75 KB
                                           <class 'tuple |         632 |     43.97 KB
                                         <class 'weakref |         297 |     25.52 KB
                                          <class 'method |         268 |     18.84 KB
                            <class 'threading._Condition |         297 |     18.56 KB
  <class 'requests.packages.urllib3.util.timeout.Timeout |         279 |     17.44 KB
                                   function (weakref_cb) |          99 |     13.15 KB
                                    <class '_thread.lock |         297 |      9.28 KB
                                    
Line #    Mem usage    Increment   Line Contents
================================================
   205     41.7 MiB      0.0 MiB       @profile
   206                                 def _process_identify_futures(self, futures, opts, instances):
   207     41.7 MiB      0.0 MiB           self.out.debug('scan._process_identify_futures')
   208     41.7 MiB      0.0 MiB           to_scan = {}
   209     42.8 MiB      1.1 MiB           for future_dict in futures:
   210     42.8 MiB      0.0 MiB               future = future_dict['future']
   211
   212     42.8 MiB      0.0 MiB               try:
   213     42.8 MiB      0.0 MiB                   cms_name, result_tuple = future.result(timeout=opts['timeout_host'])
   214
   215     42.8 MiB      0.0 MiB                   if cms_name != None:
   216     42.8 MiB      0.0 MiB                       if cms_name not in to_scan:
   217     42.8 MiB      0.0 MiB                           to_scan[cms_name] = []
   218
   219     42.8 MiB      0.0 MiB                       to_scan[cms_name].append(result_tuple)
   220     42.8 MiB      0.0 MiB               except:
   221                                             #f.exc_handle(future_dict['url'], self.out, self.app.testing)
   222     42.8 MiB      0.0 MiB                   pass
   223
   224     42.8 MiB      0.0 MiB           if to_scan:
   225     42.9 MiB      0.2 MiB               self._process_scan(opts, instances, to_scan)
   226     42.9 MiB      0.0 MiB               to_scan = {}


Filename: /root/droopescan/dscan/plugins/internal/scan.py

Line #    Mem usage    Increment   Line Contents
================================================
   161     36.9 MiB      0.0 MiB       @profile
   162                                 def _process_generate_futures(self, urls, executor, opts, instances,
   163                                         follow_redirects):
   164
   165     36.9 MiB      0.0 MiB           futures = []
   166     41.7 MiB      4.7 MiB           for url in urls:
   167     41.7 MiB      0.0 MiB               url = url.strip()
   168     41.7 MiB      0.0 MiB               future = executor.submit(self._process_cms_identify, url,
   169     41.7 MiB      0.0 MiB                       opts, instances, follow_redirects)
   170
   171     41.7 MiB      0.0 MiB               futures.append({
   172     41.7 MiB      0.0 MiB                   'url': url,
   173     41.7 MiB      0.0 MiB                   'future': future
   174                                         })
   175
   176     42.9 MiB      1.3 MiB           self._process_identify_futures(futures, opts, instances)

                                    
                                    
        - did not find base_plugin_internal.url_scan -> ('http://89.31.143.7/', '0049ev.com')
            i.e. detected by fingerprint but not scanned by url_scan

Version 2.x:
    - Break API to remove finds, isempty. Instead, simply return finds.
    - Break API to replace 'interesting urls' key with 'interesting_urls'.
    - Break API to add url (the URL which was requested to be scanned) and final_url which is the URL after redirects.
    - Break API to detect plugin version.
    - Wordpress?

Relevant:
- https://wappalyzer.com/ -
  http://www.opensourcecms.com/general/cms-marketshare.php

{"host_header": "0010.idv.tw", "host": "http://157.7.235.109/", "version": {"is_empty": false, "finds": ["2.5.18", "2.5.19", "2.5.20", "2.5.21", "2.5.22", "2.5.23", "2.5.24", "2.5.25", "2.5.26", "2.5.27"]}, "line": "http://157.7.235.109/", "cms_name": "joomla"}
{"host_header": "0014d1c9cdd8.click-network.com", "host": "http://131.191.14.148/", "version": {"is_empty": false, "finds": ["2.5.28", "2.5.28.rc2"]}, "line": "http://131.191.14.148/", "cms_name": "joomla"}
{"host_header": "0010.info", "host": "http://96.8.117.140/", "version": {"is_empty": false, "finds": ["4.2.2"]}, "line": "http://96.8.117.140/", "cms_name": "wordpress"}
{"host_header": "0010.ru", "host": "http://37.140.192.125/", "version": {"is_empty": false, "finds": ["3.6", "3.6.1"]}, "line": "http://37.140.192.125/", "cms_name": "wordpress"}
{"host_header": null, "host": "http://www.00100web.it/", "version": {"is_empty": false, "finds": ["3.4", "3.4.1", "3.4.2"]}, "line": "http://www.00100web.it/", "cms_name": "wordpress"}
{"host_header": "001081.com", "host": "http://157.7.184.20/", "version": {"is_empty": false, "finds": ["4.1.1", "4.1.2", "4.1.3", "4.1.4", "4.1.5", "4.2", "4.2.1"]}, "line": "http://157.7.184.20/", "cms_name": "wordpress"}
{"host_header": "0010878.com", "host": "http://198.55.121.100/", "version": {"is_empty": false, "finds": ["4.2.2"]}, "line": "http://198.55.121.100/", "cms_name": "wordpress"}
{"host_header": "00187.it", "host": "http://92.222.25.156/", "version": {"is_empty": false, "finds": ["4.2.2"]}, "line": "http://92.222.25.156/", "cms_name": "wordpress"}
{"host_header": "001bocai.com", "host": "http://5.44.233.202/", "version": {"is_empty": false, "finds": ["3.8.6", "3.8.7", "3.8.8"]}, "line": "http://5.44.233.202/", "cms_name": "wordpress"}
{"host_header": null, "host": "http://www.001d.com/", "version": {"is_empty": false, "finds": ["4.2.2"]}, "line": "http://www.001d.com/", "cms_name": "wordpress"}
